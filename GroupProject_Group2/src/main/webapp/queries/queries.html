<!DOCTYPE html>
<html ng-app>
	<head>
		<meta charset="ISO-8859-1">
		<title>Queries</title>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
		
	</head>
	<body ng-controller="queryReferenceLoader">
		
		<br><br>
		<form enctype="multipart/form-data"  style="text-align:center">
			Select querytype:
			<select id="querySelection">
				<option ng-repeat="query in queries" value={{query.id}}>{{query.displayName}}</option>
			</select>
			<input type="button" onClick='alterQuery();' value="Refresh Query Type"/>
		</form>
		<br><br>
		
		<iframe id="formFrame" src="/GroupProject_Group2/queries/imsibydate.html" frameborder=0 width="100%"></iframe>
		<br>
		<iframe id="tableFrame" src="/GroupProject_Group2/queries/querytable.html" frameborder=0 width="100%"></iframe>
		
		<script>
			function queryReferenceLoader($scope, $http) {
				var x = readCookie('usercookie');
				var userType = x.charAt(x.length-2);
				$http.get('/GroupProject_Group2/rest/queries/' + userType).
				success(function(data) {
					$scope.queries = data;
				});
			}

			function readCookie(name) {
				var nameEQ = name + "=";
				var ca = document.cookie.split(';');
				for (var i = 0; i < ca.length; i++) {
					var c = ca[i];
					while (c.charAt(0) == ' ')
					c = c.substring(1, c.length);
					if (c.indexOf(nameEQ) == 0) {
						return c.substring(nameEQ.length, c.length);
					}
				}
				return null;
			}

			function alterQuery(){
				var choice = document.getElementById('querySelection').value;
				var formFrame = document.getElementById('formFrame');
				if(choice==1){
					window.name = "ib2d"
					formFrame.src = "/GroupProject_Group2/queries/imsibydate.html";
				}else{
					window.name = "cmbd"
					formFrame.src = "/GroupProject_Group2/queries/countmodelfailuresbydate.html";
				}
				/* formFrame.reload(); */
			}
		</script>
		
	</body>
</html>