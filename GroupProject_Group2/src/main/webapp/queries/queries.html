<!DOCTYPE html>
<html ng-app>
	<head>
		<meta charset="ISO-8859-1">
		<title>Queries</title>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
		
		<script language="javascript" type="text/javascript">
			function resizeTableFrame() {
				var tableFrame = document.getElementById('tableFrame');
				tableFrame.style.height = tableFrame.contentWindow.document.body.scrollHeight + 'px';
			}
		</script>
	</head>
	
	<body ng-controller="queryReferenceLoader">
		<br><br>
		<form enctype="multipart/form-data"  style="text-align:center">
			Select querytype:
			<select id="querySelection">
				<option ng-repeat="query in queries" value={{query.id}}>{{query.displayName}}</option>
			</select>
			<input type="button" onClick='alterQuery();' value="Refresh Query Type"/>
		</form>
		<br><br>
		
		<iframe id="formFrame" src="/GroupProject_Group2/queries/imsibydate.html" frameborder=0 width="100%"></iframe>
		<br>
		<iframe id="tableFrame" src="/GroupProject_Group2/queries/querytable.html" frameborder=0 width="100%" height="600"></iframe>
		
		<script>
			function queryReferenceLoader($scope, $http) {
				var x = readCookie('usercookie');
				var userType = x.charAt(x.length-2);
				$http.get('/GroupProject_Group2/rest/queries/' + userType).
				success(function(data) {
					$scope.queries = data;
				});
			}

			function readCookie(name) {
				var nameEQ = name + "=";
				var ca = document.cookie.split(';');
				for (var i = 0; i < ca.length; i++) {
					var c = ca[i];
					while (c.charAt(0) == ' ')
					c = c.substring(1, c.length);
					if (c.indexOf(nameEQ) == 0) {
						return c.substring(nameEQ.length, c.length);
					}
				}
				return null;
			}

			function alterQuery(){
				var choice = document.getElementById('querySelection').value;
				var formFrame = document.getElementById('formFrame');
				if(choice==1){
					window.name = "c01"
					formFrame.src = "/GroupProject_Group2/queries/todoform.html";
				}else if(choice==2){
					window.name = "c02"
					formFrame.src = "/GroupProject_Group2/queries/imsibydate.html";
				}else if(choice==3){
					window.name = "c03"
					formFrame.src = "/GroupProject_Group2/queries/countmodelfailuresbydate.html";
				}else if(choice==4){
					window.name = "c04"
					formFrame.src = "/GroupProject_Group2/queries/countimsibydate.html";
				}else if(choice==5){
					window.name = "c05"
					formFrame.src = "/GroupProject_Group2/queries/todoform.html";
				}else if(choice==6){
					window.name = "c06"
					formFrame.src = "/GroupProject_Group2/queries/countsingleimsibydate.html";
				}else if(choice==7){
					window.name = "c07"
					formFrame.src = "/GroupProject_Group2/queries/todoform.html";
				}else if(choice==8){
					window.name = "c08"
					formFrame.src = "/GroupProject_Group2/queries/todoform.html";
				}else if(choice==9){
					window.name = "c09"
					formFrame.src = "/GroupProject_Group2/queries/todoform.html";
				}else if(choice==10){
					window.name = "c10"
					formFrame.src = "/GroupProject_Group2/queries/todoform.html";
				}
			}
		</script>
	</body>
</html>